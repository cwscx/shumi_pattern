<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Baby Tracker - æ–½èˆ’ç±³</title>
    <style>
        body { font-family: sans-serif; background: #f4f7f6; padding: 20px; color: #333; }
        .card { background: white; padding: 20px; border-radius: 12px; box-shadow: 0 4px 6px rgba(0,0,0,0.1); max-width: 500px; margin: auto; }
        h2 { text-align: center; color: #ff85a2; }
        .input-group { margin-bottom: 15px; }
        label { display: block; margin-bottom: 5px; font-weight: bold; }
        input, select { width: 100%; padding: 10px; border: 1px solid #ddd; border-radius: 6px; box-sizing: border-box; }
        .btn-grid { display: grid; grid-template-columns: 1fr 1fr 1fr; gap: 10px; margin-top: 20px; }
        button { padding: 12px; border: none; border-radius: 6px; cursor: pointer; font-weight: bold; transition: 0.3s; }
        .btn-milk { background: #e3f2fd; color: #1976d2; }
        .btn-sleep { background: #f3e5f5; color: #7b1fa2; }
        .btn-diaper { background: #fff3e0; color: #f57c00; }
        .btn-export { background: #4caf50; color: white; width: 100%; margin-top: 20px; }
        .log-list { margin-top: 20px; font-size: 0.9em; max-height: 200px; overflow-y: auto; border-top: 1px solid #eee; padding-top: 10px; }
    </style>
</head>
<body>

<div class="card">
    <h2>ğŸ‘¶ æ–½èˆ’ç±³ Tracker</h2>
    
    <div class="input-group">
        <label>å½“å‰æ—¥æœŸ</label>
        <input type="date" id="currentDate">
    </div>

    <div class="btn-grid">
        <button class="btn-milk" onclick="addAction('å–å¥¶')">ğŸ¼ å–å¥¶</button>
        <button class="btn-sleep" onclick="addAction('ç¡çœ ')">ğŸ˜´ ç¡çœ </button>
        <button class="btn-diaper" onclick="addAction('æ¢å°¿å¸ƒ')">ğŸ§· å°¿å¸ƒ</button>
    </div>

    <div id="dynamicInputs" style="margin-top: 15px; display: none; padding: 10px; border: 1px solid #eee; border-radius: 8px;">
        </div>

    <div class="log-list" id="logList">
        <strong>ä»Šæ—¥è®°å½•:</strong>
        <div id="entries"></div>
    </div>

    <button class="btn-export" onclick="exportJSON()">ğŸ“¥ å¯¼å‡º JSON æ–‡ä»¶</button>
</div>

<script>
    // Initial Data Structure
    let babyData = {
        "name": "æ–½èˆ’ç±³",
        "birthday": "2025/09/06",
        "sex": "female",
        "patterns": []
    };

    // Set default date to today
    const today = new Date().toISOString().split('T')[0];
    document.getElementById('currentDate').value = today;

    function getCurrentTime() {
        return new Date().toLocaleTimeString('en-GB', { hour: '2-digit', minute: '2-digit' });
    }

    function addAction(actionType) {
        const container = document.getElementById('dynamicInputs');
        container.style.display = 'block';
        let html = `<h4>è®°å½• ${actionType}</h4>`;

        if (actionType === 'å–å¥¶') {
            html += `
                <label>ç±»å‹</label><select id="subType"><option>é…æ–¹å¥¶</option><option>æ¯ä¹³</option></select>
                <label>å¥¶é‡ (ml)</label><input type="text" id="volume" value="130ml">
            `;
        } else if (actionType === 'æ¢å°¿å¸ƒ') {
            html += `
                <label>ç±»å‹</label><select id="subType"><option>å˜˜å˜˜</option><option>è‡­è‡­</option><option>å¹²çˆ½</option></select>
            `;
        } else if (actionType === 'ç¡çœ ') {
            html += `
                <label>ç»“æŸæ—¶é—´ (å¯é€‰)</label><input type="time" id="timeEnd">
            `;
        }

        html += `<label>å¼€å§‹æ—¶é—´</label><input type="time" id="timeStart" value="${getCurrentTime()}">`;
        html += `<button style="margin-top:10px; width:100%" onclick="saveEntry('${actionType}')">ç¡®è®¤æ·»åŠ </button>`;
        container.innerHTML = html;
    }

    function saveEntry(action) {
        const date = document.getElementById('currentDate').value.replaceAll('-', '/');
        const timeStart = document.getElementById('timeStart').value;
        
        let entry = { action, time_start: timeStart };

        if (action === 'å–å¥¶') {
            entry.type = document.getElementById('subType').value;
            entry.volume = document.getElementById('volume').value;
        } else if (action === 'æ¢å°¿å¸ƒ') {
            entry.type = document.getElementById('subType').value;
        } else if (action === 'ç¡çœ ') {
            const end = document.getElementById('timeEnd').value;
            if (end) entry.time_end = end;
        }

        // Find or create the date pattern
        let dayPattern = babyData.patterns.find(p => p.date === date);
        if (!dayPattern) {
            dayPattern = { date: date, actions: [] };
            babyData.patterns.push(dayPattern);
        }
        dayPattern.actions.push(entry);

        updateLog();
        document.getElementById('dynamicInputs').style.display = 'none';
    }

    function updateLog() {
        const entriesDiv = document.getElementById('entries');
        const date = document.getElementById('currentDate').value.replaceAll('-', '/');
        const dayPattern = babyData.patterns.find(p => p.date === date);
        
        if (dayPattern) {
            entriesDiv.innerHTML = dayPattern.actions.map(a => 
                `<div>[${a.time_start}] ${a.action} ${a.type || ''} ${a.volume || ''}</div>`
            ).join('');
        }
    }

    function exportJSON() {
        const dataStr = "data:text/json;charset=utf-8," + encodeURIComponent(JSON.stringify(babyData, null, 4));
        const downloadAnchorNode = document.createElement('a');
        downloadAnchorNode.setAttribute("href", dataStr);
        downloadAnchorNode.setAttribute("download", "baby_log.json");
        document.body.appendChild(downloadAnchorNode);
        downloadAnchorNode.click();
        downloadAnchorNode.remove();
    }
</script>

</body>
</html>