{% load static %}
<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>æ–½èˆ’ç±³ Tracker Pro</title>
    <link rel="stylesheet" href="{% static 'style.css' %}">
</head>
<body>

<div class="app-wrapper">
    <!-- <header>
        <h1>ğŸ‘¶ æ–½èˆ’ç±³ Tracker</h1>
    </header>
 -->
    <header class="observation-header">
        <div class="status-badge">
            <span class="pulse"></span> å®æ—¶ç›‘æµ‹ä¸­
        </div>
        <h1 class="main-title">æ–½èˆ’ç±³ å¹¼å´½è§‚å¯Ÿç«™</h1>
        <p class="header-subtitle">ğŸ”¬ 24/7 å®æ—¶ç›‘æµ‹äººç±»å¹¼å´½çš„è¿·æƒ‘è¡Œä¸º</p>
    </header>
    <div class="main-container">
        <div class="left-col">
            <div class="card">
                <h3>ğŸ“‚ å½•å…¥æƒ…æŠ¥æ•°æ®</h3> <p class="subtitle" style="font-size: 0.85em; color: #888; margin-bottom: 15px;">
            è®°å½•æ¯ä¸€ä¸ªå±å°¿å±çš„ç¬é—´...
        </p>
                <div class="input-group">
                    <label>æƒ…æŠ¥å‘ç”Ÿæ—¥æœŸ</label>
                    <input type="date" id="currentDate" value="{{ current_pst_date }}">
                    <label>å‘ç”Ÿæ—¶åŒº (Timezone)</label>
                    <select id="timezoneSelect" class="form-select">
                    <option value="PST" selected>ğŸ‡ºğŸ‡¸ åŠ å· (PST/PDT)</option>
                    <option value="CST">ğŸ‡¨ğŸ‡³ ä¸­å›½ (CST)</option>
                    </select>
                </div>

                <div class="btn-grid">
                    <button class="btn-milk" onclick="addAction('å–å¥¶')">ğŸ¼ å–å¥¶</button>
                    <button class="btn-sleep" onclick="addAction('ç¡çœ ')">ğŸ˜´ ç¡çœ </button>
                    <button class="btn-diaper" onclick="addAction('æ¢å°¿å¸ƒ')">ğŸ§· å°¿å¸ƒ</button>
                </div>

                <div id="dynamicInputs" class="dynamic-inputs-area"></div>
            </div>

            <div class="card log-card">
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>

    <div class="card chart-card">
        <h3>ğŸ“ˆ ç±³å®è¡Œä¸ºæ—¶é—´è½´ (24h)</h3>
        <div class="chart-container">
            <canvas id="routineChart"></canvas>
        </div>
    </div>
    <div id="entries">
    {% if past_days_data %}
        {% for day in past_days_data %}
            <div class="day-group">
                <div class="day-header">ğŸ“… {{ day.date }}</div>
                
                {% for item in day.actions %}
                    <div class="entry-item 
                        {% if item.action == 'å–å¥¶' %}entry-milk
                        {% elif item.action == 'ç¡çœ ' %}entry-sleep
                        {% elif item.action == 'æ¢å°¿å¸ƒ' %}entry-diaper{% endif %}">
                        
                        <div class="entry-content">
                            <span class="time">[{{ item.time_start }}]</span>
                            <strong>{{ item.action }}</strong>
                            <span class="details">
                                {% if item.type %} Â· {{ item.type }}{% endif %}
                                {% if item.volume %} Â· {{ item.volume }}{% endif %}
                                
                                {% if item.duration %}
                                    <span class="duration-tag">â± {{ item.duration }}</span>
                                {% endif %}
                            </span>
                        </div>

                        <button class="btn-delete" onclick="deleteAction('{{ day.date }}', {{ item.index_in_file }})">
                            &times;
                        </button>
                    </div>
                {% endfor %}
            </div>
        {% endfor %}
    {% endif %}
</div>
</div>
        </div>

        <div class="right-col">
            <div class="card prediction-card">
    <div class="card-header">
        <h3>ğŸ”® å¹¼å´½è¡Œä¸ºé¢„åˆ¤</h3>
    </div>
    
    <div id="predictionDisplay" class="prediction-main">
        <div id="shumiLoader" class="shumi-loader" style="display: none;">
            <div class="flip-container">
                <img src="{% static 'images/shumi_3.PNG' %}" class="shumi-flip-pic">
            </div>
            <p class="loading-subtext">
                çŒœçŒœæˆ‘æ¥ä¸‹æ¥è¦å¹²å˜›<span class="dot-ani"></span>
            </p>
        </div>
        
        <span class="prediction-text" id="nextAction"></span>
    </div>

    <div id="confidenceWrapper" style="display: none; margin-top: 20px;">
        <div style="display: flex; justify-content: space-between; font-size: 0.8rem; margin-bottom: 5px;">
            <span>ä¿¡å·åŒ¹é…åº¦</span>
            <span id="confValue">0%</span>
        </div>
        <div class="meter-container">
            <div id="meterFill" class="meter-fill"></div>
        </div>
    </div>

    <div id="reasoningSection" style="display: none;">...</div>

    <div class="prediction-controls">
        <button class="btn-get-forecast" id="forecastBtn" onclick="updatePrediction()">ğŸ“¡ å‘é€ä¿¡å·</button>
        <button class="btn-expand" id="expandBtn" onclick="toggleReasoning()" style="display: none;">æŸ¥çœ‹æ¨ç†è¯¦æƒ…</button>
    </div>
</div>
            <div class="card ai-card">
                <h3>ğŸ¤– ç±³è¯­ç¿»è¯‘æœº</h3>
                <p class="subtitle">ğŸ¼ æŠŠå±å°¿å±ç¿»è¯‘æˆäººç±»èƒ½å¬æ‡‚çš„å»ºè®®</p>
                
                <textarea id="userQuery" placeholder="è¾“å…¥ç‰¹å®šé—®é¢˜ï¼ˆä¾‹å¦‚ï¼šæœ€è¿‘å¥¶é‡æœ‰å‡å°‘å—ï¼Ÿï¼‰æˆ–ä¿æŒç©ºç™½ä»¥è·å–æ·±åº¦å…¨é¡¹æŠ¥å‘Š..." rows="3"></textarea>
                
                <button class="btn-ai" id="aiBtn" onclick="generateInsights()">ğŸš€ å¯åŠ¨èˆ’ç±³å¿ƒæ™ºç ´è§£ç¨‹åº</button>
                
                <div id="aiContent" class="ai-response-area" style="display: none;">
                    <div id="aiText">æ­£åœ¨è¯»å– æ–½èˆ’ç±³ çš„æˆé•¿è®°å½•...</div>
                </div>
            </div>
        </div>
    </div>
</div>

<script id="chart-data" type="application/json">
    {{ chart_data_json|safe }}
</script>
<script src="{% static 'script.js' %}"></script>
</body>
</html>